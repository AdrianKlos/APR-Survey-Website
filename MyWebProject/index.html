<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Approach & Procrastination Survey</title>
    <style>

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        #consent-form, #survey-section, #feedback-section {
            margin: 2rem auto;
            max-width: 600px;
            padding: 1.5rem;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        button {
            margin: 0.5rem 0;
            padding: 0.75rem 1.25rem;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .question {
            margin-bottom: 1rem;
        }

        .rating {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
            gap: 0.5rem;
        }
        .rating label {
            font-size: 0.9rem;
            color: #555;
        }
        hr {
            border: 1px solid #ddd;
            margin: 1rem 0;
        }

    </style>

</head>
<body>
<div id="consent-form" style="text-align: center">
    <h1>Consent Form</h1>
    <img src="https://i.postimg.cc/C5bvbwB7/Connor-s-Consent-Form.png" alt="Consent Form">
    <button onclick="showSurvey()">I Consent</button>
    <br>
    <button onclick="declineSurvey()">I Do Not Consent</button>
</div>

<div id="survey-section" style="display: none;">
    <h1>Learning Approach Survey</h1>
    <form id="survey-form">
        <!-- Questions dynamically added here -->
    </form>
    <button id="submit-part-a" onclick="submitPartA()">Submit Section 1</button>
    <div id="section-1-results" style="display: none;">
        <h2>Section 1 Results</h2>
        <p id="part-a-feedback"></p>
        <button onclick="showPartB()">Continue to Section 2</button>
    </div>
    <button id="submit-part-b" onclick="submitPartB()" style="display: none;">Submit Section 2</button>
</div>
<div id="feedback-section" style="display: none;">
    <h1>Your Final Results</h1>
    <p id="feedback"></p>
    <button onclick="exportData()">Export to Google Sheets</button>
</div>
<script>

    function showSurvey() {
        document.getElementById('consent-form').style.display = 'none';
        document.getElementById('survey-section').style.display = 'block';

        const partAQuestions = [
            "I find that at times studying gives me a feeling of deep personal satisfaction.",
            "I find that I have to do enough work on a topic so that I can form my own conclusions before I am satisfied.",
            "My aim is to pass the course while doing as little work as possible.",
            "I only study seriously what's given out in class or in the course outlines.",
            "I feel that virtually any topic can be highly interesting once I get into it.",
            "I find most new topics interesting and often spend extra time trying to obtain more information about them.",
            "I do not find my course very interesting so I keep my work to the minimum.",
            "I learn some things by rote, going over and over them until I know them by heart even if I do not understand them.",
            "I find that studying academic topics can at times be as exciting as a good novel or movie.",
            "I test myself on important topics until I understand them completely.",
            "I find I can get by in most assessments by memorising key sections rather than trying to understand them.",
            "I generally restrict my study to what is specifically set as I think it is unnecessary to do anything extra.",
            "I work hard at my studies because I find the material interesting.",
            "I spend a lot of my free time finding out more about interesting topics which have been discussed in different classes.",
            "I find it is not helpful to study topics in depth. It confuses and wastes time, when all you need is a passing acquaintance with topics.",
            "I believe that lecturers shouldn't expect students to spend significant amounts of time studying material everyone knows won't be examined.",
            "I come to most classes with questions in mind that I want answering.",
            "I make a point of looking at most of the suggested readings that go with the lectures.",
            "I see no point in learning material which is not likely to be in the examination.",
            "I find the best way to pass examinations is to try to remember answers to likely questions."
        ];

        const surveyForm = document.getElementById('survey-form');
        partAQuestions.forEach((question, index) => {
            surveyForm.innerHTML += `
            <div class="question">
                <p>Question ${index + 1}: ${question}</p>
                <div class="rating">
                    <label>Strongly Disagree (1)</label>
                    <input type="radio" name="question-a${index + 1}" value="1" required>
                    <input type="radio" name="question-a${index + 1}" value="2">
                    <input type="radio" name="question-a${index + 1}" value="3">
                    <input type="radio" name="question-a${index + 1}" value="4">
                    <input type="radio" name="question-a${index + 1}" value="5">
                    <label>Strongly Agree (5)</label>
                </div>
                <hr>
            </div>
        `;
        });
    }

    function showPartB() {
        document.getElementById('section-1-results').style.display = 'none';

        // Clear previous questions from the form
        const surveyForm = document.getElementById('survey-form');
        surveyForm.innerHTML = '';

        // Add header for Section 2
        const sectionBHeader = `
        <h2>Procrastination Survey</h2>
        <p>Please rate how much you agree with the following statements:</p>
    `;
        surveyForm.innerHTML = sectionBHeader;

        const partBQuestions = [
            "My performance tends to suffer when I have to race against deadlines.",
            "I don't do well if I have to rush through a task.",
            "If I put things off until the last moment, I'm not satisfied with their outcomes.",
            "I achieve better results if I complete a task at a slower pace, well ahead of a deadline.",
            "It's really a pain for me to work under upcoming deadlines.",
            "I'm upset and reluctant to act when I'm forced to work under pressure.",
            "I feel tense and cannot concentrate when there's too much time pressure on me.",
            "I'm frustrated when I have to rush to meet deadlines.",
            "To use my time more efficiently, I deliberately postpone some tasks.",
            "I intentionally put off work to maximize my motivation.",
            "In order to make better use of my time, I intentionally put off some tasks.",
            "I finish most of my assignments right before deadlines because I choose to do so.",
            "I often start things at the last minute and find it difficult to complete them on time.",
            "I often fail to accomplish goals that I set for myself.",
            "I'm often running late when getting things done.",
            "I have difficulty finishing activities once I start them."
        ];

        partBQuestions.forEach((question, index) => {
            surveyForm.innerHTML += `
            <div class="question">
                <p>Question ${index + 1}: ${question}</p>
                <div class="rating">
                    <label>Strongly Disagree (1)</label>
                    <input type="radio" name="question-b${index + 1}" value="1" required>
                    <input type="radio" name="question-b${index + 1}" value="2">
                    <input type="radio" name="question-b${index + 1}" value="3">
                    <input type="radio" name="question-b${index + 1}" value="4">
                    <input type="radio" name="question-b${index + 1}" value="5">
                    <label>Strongly Agree (5)</label>
                </div>
                <hr>
            </div>
        `;
        });

        document.getElementById('submit-part-b').style.display = 'block';

    }


    function submitPartA() {
        const form = document.getElementById('survey-form');
        const formData = new FormData(form);

        let deepTotal = 0, surfaceTotal = 0;

        // Calculate Deep and Surface scores (Part A)
        for (let i = 1; i <= 10; i++) {
            deepTotal += parseInt(formData.get(`question-a${i}`), 10);
        }
        for (let i = 11; i <= 20; i++) {
            surfaceTotal += parseInt(formData.get(`question-a${i}`), 10);
        }

        const deepAverage = deepTotal / 10;
        const surfaceAverage = surfaceTotal / 10;

        let feedback = '';
        if (deepAverage > surfaceAverage) {
            feedback += "You are a deep learner. This means you are more independent in your learning.";
        } else {
            feedback += "You are a surface learner. This means you are more syllabus-dependent in your learning.";
        }

        document.getElementById('part-a-feedback').innerHTML = feedback;
        document.getElementById('submit-part-a').style.display = 'none';
        document.getElementById('section-1-results').style.display = 'block';
    }

    function submitPartB() {
        const form = document.getElementById('survey-form');
        const formData = new FormData(form);

        let procrastinationTotal = 0;

        // Calculate Procrastination score (Part B)
        for (let i = 1; i <= 16; i++) {
            procrastinationTotal += parseInt(formData.get(`question-b${i}`), 10);
        }

        const procrastinationAverage = procrastinationTotal / 16;

        let feedback = '';
        if (procrastinationAverage > 3) {
            feedback += "You are an active procrastinator. You procrastinate intentionally and productively.";
        } else {
            feedback += "You are a passive procrastinator. You procrastinate subconsciously and counterproductively.";
            feedback += " Thank you for your time in taking this survey!";
        }

        document.getElementById('survey-section').style.display = 'none';
        document.getElementById('feedback').innerHTML = feedback;
        document.getElementById('feedback-section').style.display = 'block';
    }

    function declineSurvey() {
        alert("You have opted out of the survey.");
        document.getElementById('consent-form').style.display = 'none';
    }

async function exportData() {
    const age = prompt("Please enter your age (e.g., 'underclassmen' or 'upperclassmen'):");

    const DA = calculateScore([1, 2, 5, 6, 9, 10, 13, 14, 17, 18]);
    const SA = calculateScore([3, 4, 7, 8, 11, 12, 15, 16, 19, 20]);
    const DM = calculateScore([1, 5, 9, 13, 17]);
    const DS = calculateScore([2, 6, 10, 14, 18]);
    const SM = calculateScore([3, 7, 11, 15, 19]);
    const SS = calculateScore([4, 8, 12, 16, 20]);
    const AAPS = document.getElementById('feedback').textContent.includes('active') ? 'Active' : 'Passive';

    const data = { age, DA, SA, DM, DS, SM, SS, AAPS };

    try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyceAF1RGIeaGhl2n65PjRq-r-rzSM4CYirEXxtlQlcDoRjNbvSxxMkVNMVph1eNVkc/exec', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        // Check if the response is JSON
        if (response.headers.get('Content-Type')?.includes('application/json')) {
            const result = await response.json();
            if (result.status === 'success') {
                alert('Data exported successfully!');
            } else {
                alert('Failed to export data. Please try again.');
            }
        } else {
            // Response is not JSON (likely an error page)
            const errorText = await response.text();
            console.error('Error response:', errorText);
            alert('An unexpected error occurred. Please check the console for details.');
        }
    } catch (error) {
        alert('An error occurred during export: ' + error.message);
    }
}



    function calculateScore(indices) {
        const form = document.getElementById('survey-form');
        const formData = new FormData(form);
        let totalScore = 0;

        indices.forEach(index => {
            totalScore += parseInt(formData.get(`question-a${index}`), 10);
        });

        return totalScore / indices.length; // Return the average score
    }

</script>
</body>
</html>
